<!DOCTYPE html>
<html>
<head>
    <title>API Endpoint Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Frontend-Backend API Endpoint Test</h1>
    
    <div>
        <h2>Configuration</h2>
        <label>Base URL: <input type="text" id="baseUrl" value="http://localhost:8000/api/v1" /></label><br><br>
        <label>Auth Token: <input type="text" id="authToken" placeholder="Paste JWT token here" /></label><br><br>
        <button onclick="loadFromLocalStorage()">Load from localStorage</button>
        <button onclick="testAllEndpoints()">Test All Endpoints</button>
    </div>

    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        function loadFromLocalStorage() {
            const token = localStorage.getItem('access_token');
            if (token) {
                document.getElementById('authToken').value = token;
                addResult('info', 'Loaded auth token from localStorage');
            } else {
                addResult('warning', 'No auth token found in localStorage');
            }
        }

        function addResult(type, message, details = '') {
            const div = document.createElement('div');
            div.className = `test-result ${type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning'}`;
            div.innerHTML = `
                <strong>${message}</strong>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            results.appendChild(div);
        }

        async function testEndpoint(method, url, description, expectedStatus = 200) {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('authToken').value;

            try {
                const response = await fetch(`${baseUrl}${url}`, {
                    method: method,
                    headers: {
                        'Authorization': token ? `Bearer ${token}` : '',
                        'Content-Type': 'application/json',
                    }
                });

                const status = response.status;
                const isSuccess = status === expectedStatus || (expectedStatus === 200 && status >= 200 && status < 300);
                
                let responseText = '';
                try {
                    const json = await response.json();
                    responseText = JSON.stringify(json, null, 2);
                } catch (e) {
                    responseText = await response.text();
                }

                addResult(
                    isSuccess ? 'success' : 'error',
                    `${method} ${url} - ${description}`,
                    `Status: ${status}\n${responseText.substring(0, 500)}${responseText.length > 500 ? '...' : ''}`
                );

                return { success: isSuccess, status, data: responseText };
            } catch (error) {
                addResult('error', `${method} ${url} - ${description}`, `Network Error: ${error.message}`);
                return { success: false, error: error.message };
            }
        }

        async function testAllEndpoints() {
            results.innerHTML = '<h2>Test Results</h2>';
            
            // Test Lists endpoints
            addResult('info', '=== TESTING LISTS ENDPOINTS ===');
            await testEndpoint('GET', '/lists/', 'Get all lists');
            await testEndpoint('GET', '/lists/agenda/', 'Get agenda');
            await testEndpoint('GET', '/lists/analytics/', 'Get analytics');
            await testEndpoint('GET', '/lists/templates/', 'Get templates');
            
            // Test Todos endpoints  
            addResult('info', '=== TESTING TODOS ENDPOINTS ===');
            await testEndpoint('GET', '/todos/goals/', 'Get goals');
            await testEndpoint('GET', '/todos/tasks/', 'Get tasks');
            await testEndpoint('GET', '/todos/templates/', 'Get task templates');
            await testEndpoint('GET', '/todos/tags/', 'Get tags');
            await testEndpoint('GET', '/todos/subtasks/', 'Get subtasks');
            await testEndpoint('GET', '/todos/time-entries/', 'Get time entries');
            await testEndpoint('GET', '/todos/comments/', 'Get comments');
            await testEndpoint('GET', '/todos/reminders/', 'Get reminders');
            await testEndpoint('GET', '/todos/recurring-templates/', 'Get recurring templates');
            await testEndpoint('GET', '/todos/custom-fields/', 'Get custom fields');
            await testEndpoint('GET', '/todos/insights/', 'Get AI insights');
            await testEndpoint('GET', '/todos/notes/', 'Get task notes');
            await testEndpoint('GET', '/todos/attachments/', 'Get attachments');
            await testEndpoint('GET', '/todos/activity-logs/', 'Get activity logs');
            await testEndpoint('GET', '/todos/tasks/dashboard_stats/', 'Get dashboard stats');
            
            // Test other endpoints
            addResult('info', '=== TESTING OTHER ENDPOINTS ===');
            await testEndpoint('GET', '/expenses/', 'Get expenses');
            await testEndpoint('GET', '/users/', 'Get users');
            await testEndpoint('GET', '/budgets/', 'Get budgets');
            
            addResult('info', 'Testing complete!');
        }

        // Load token on page load
        window.onload = loadFromLocalStorage;
    </script>
</body>
</html>
